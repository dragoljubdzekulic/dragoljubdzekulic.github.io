<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="utf-8">
  <title>3xMeri – Frontend kalkulator elemenata (tabs + vertikalni layout)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self' data:;
    img-src 'self' data:;
    style-src 'self' 'unsafe-inline';
    script-src 'self';
    connect-src 'self';
    object-src 'none';
    base-uri 'self';
  ">
  <style>
    :root{
      --bg:#0c111b;--panel:#0f1726;--card:#101729;--line:#1e2636;--text:#e9eef5;--muted:#9aa7b8;--good:#7fdebf;--bad:#f59b9b
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
    h1,h2{margin:.2rem 0 .6rem 0; font-weight:600}
    h1{font-size:22px}
    h2{font-size:16px}
    a{color:#9cc7ff;text-decoration:none}
    a:hover{text-decoration:underline}
    .wrap{max-width:1200px;margin:0 auto;padding:12px}
    .toolbar{display:flex;gap:8px;align-items:center;margin-bottom:8px}
    .toolbar button{background:var(--panel);border:1px solid var(--line);color:var(--text);padding:8px 10px;border-radius:8px;cursor:pointer}
    .toolbar button:hover{filter:brightness(1.1)}

    .tabs{display:flex;gap:6px;margin:8px 0 14px}
    .tabbtn{background:var(--panel);border:1px solid var(--line);color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
    .tabbtn[aria-selected="true"]{outline:2px solid #2b87ff}

    .stack{display:flex;flex-direction:column;gap:12px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:10px}

    textarea, input, select{background:#0a1220;color:var(--text);border:1px solid var(--line);border-radius:8px;padding:8px}
    .small{font-size:12px;color:var(--muted)}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-size:12px}

    /* katalog */
    .catalog-scroll { display:flex; overflow-x:auto; gap:8px; padding-bottom:6px; scrollbar-width:thin; scroll-snap-type:x mandatory; }
    .catalog-scroll::-webkit-scrollbar { height:6px; }
    .catalog-scroll::-webkit-scrollbar-thumb { background:#333a4a; border-radius:4px; }
    .catalog-item { flex:0 0 auto; scroll-snap-align:start; background:var(--card); border:1px solid var(--line); border-radius:10px; padding:8px 10px; text-align:center; font-size:13px; min-width:120px; cursor:pointer; transition:transform .2s ease; }
    .catalog-item:hover { transform: translateY(-2px); }
    .catalog-item img { display:block; margin:0 auto 6px; width:40px; height:40px; filter:brightness(.95); transition: transform .2s ease, filter .2s ease; }
    .catalog-item:hover img { transform: scale(1.08); filter: brightness(1.15); }

    .globals-row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .globals-row input, .globals-row select { height:30px; }

    /* tab containers */
    .tabpanel{display:none}
    .tabpanel[aria-hidden="false"]{display:block}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="toolbar">
      <h1>3xMeri – modularni UI</h1>
      <div style="flex:1"></div>
      <button id="btnRun">Recompute</button>
      <button id="btnReset">Reset</button>
      <button id="btnShot">Screenshot</button>
      <button id="btnCsv">Export CSV</button>
    </div>

    <!-- Tabs header -->
    <div class="tabs" role="tablist" aria-label="Sekcije">
      <button class="tabbtn" role="tab" aria-selected="true" aria-controls="tab-config" id="tabbtn-config">Konfigurisanje</button>
      <button class="tabbtn" role="tab" aria-selected="false" aria-controls="tab-summary" id="tabbtn-summary">Rezime</button>
    </div>

    <!-- TAB 1: Konfigurisanje (vertikalni boxovi) -->
    <section id="tab-config" class="tabpanel stack" role="tabpanel" aria-hidden="false" aria-labelledby="tabbtn-config">
      <!-- Prvi: 3D prikaz -->
      <div class="card">
        <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
          <h2 style="margin:0;">3D prikaz</h2>
          <div style="flex:1"></div>
          <button id="btnIso" style="padding:6px 12px; font-size:12px;">Iso</button>
          <button id="btnTop" style="padding:6px 12px; font-size:12px;">Top</button>
          <button id="btnFront" style="padding:6px 12px; font-size:12px;">Front</button>
          <button id="btnExplode" style="padding:6px 12px; font-size:12px;">Explode</button>
        </div>
        <div id="viewer3d" style="width:100%; height:420px; background:#0c111b"></div>
        <div id="viewer3d-status" class="small" style="margin-top:6px"></div>
      </div>

      <!-- Drugi: Izbor elemenata -->
      <div class="card">
        <h2>Izbor elemenata</h2>
        <div id="catalog" class="catalog-scroll">
          <button data-type="drawer_3">+ Drawer 3</button>
          <button data-type="drawer_2">+ Drawer 2</button>
          <button data-type="combo_drawer_door">+ Combo (fioka+vrata)</button>
          <button data-type="base_1door">+ Base 1D</button>
          <button data-type="sink_1door">+ Sink 1D</button>
          <button data-type="dishwasher_60">+ Dishwasher 60</button>
          <button data-type="oven_housing">+ Oven housing</button>
          <button data-type="wall_1door">+ Viseći 1D</button>
          <button data-type="wall_open">+ Viseći otvoren</button>
          <button data-type="wall_open_shelf">+ Viseći otvoren + police</button>
        </div>
      </div>

      <!-- Treći: Lista ubačenih + podešavanja -->
      <div class="card">
        <h2>Lista ubačenih elemenata i podešavanja</h2>
        <div id="builderList" class="small" style="margin-top:4px"></div>
        <div id="lenInfo" class="small" style="margin-top:6px"></div>
        <div class="small globals-row" style="margin-top:10px;">
          <label>Visina korpusa H_carcass (mm): <input id="inpHCarcass" type="number" style="width:110px"></label>
          <label>Dubina korpusa (mm): <input id="inpDepth" type="number" style="width:100px"></label>
          <label>Debljina radne ploče (mm): <input id="inpTopThickness" type="number" style="width:120px" placeholder="npr. 38"></label>
          <label>Dubina fioka (standard):
            <select id="selDrawerDepth" style="width:130px">
              <option value="450">Plitke (450)</option>
              <option value="500" selected>Duboke (500)</option>
              <option value="550">Vrlo duboke (550)</option>
            </select>
          </label>
          <label>Toleranca šina (mm): <input id="inpSlideAllowance" type="number" style="width:120px" placeholder="npr. 26"></label>
          <label>Ukupna dužina kuhinje (mm): <input id="inpTotalLength" type="number" style="width:120px" placeholder="npr. 3000"></label>
          <label>H visećih (mm): <input id="inpHWall" type="number" style="width:90px" value="720"></label>
          <label>Donja ivica visećih (mm): <input id="inpWallBottom" type="number" style="width:110px" value="1450"></label>
          <label>Dubina visećih (mm): <input id="inpWallDepth" type="number" style="width:100px" value="320"></label>
        </div>
        <div id="bottomTotNote" class="note" style="margin-top:8px; opacity:.85;"></div>
        <div id="globals" class="small" style="margin-top:8px"></div>
        <div id="valid" class="mono" style="white-space:pre; background:#0a1220; border-radius:8px; padding:8px; margin-top:8px; min-height:60px"></div>
        <div id="msg" class="small" style="color:#f59b9b"></div>
      </div>

      <!-- (skriveni) 2D preview koji očekuju skripte -->
      <div class="card" style="display:none">
        <h2 style="display:none">Preview elemenata (2D)</h2>
        <div id="elements" class="mono" style="white-space:pre; background:#0a1220; border-radius:8px; padding:8px; min-height:120px"></div>
      </div>

      <!-- (skriveni) Ulaz (JSON) koji očekuje app.ui.js -->
      <div class="card" style="display:none">
        <h2 style="display:none">Ulaz (JSON)</h2>
        <textarea id="jsonInput">{
  "Kitchen": {
    "H_total": 900,
    "H_plinth": 110,
    "T_top": 38,
    "Gap": 2,
    "Defaults": { "CarcassDepth": 560, "SideThickness": 18 },
    "Wall": { "H_carcass": 720, "Bottom": 1450, "Defaults": { "CarcassDepth": 320 } },
    "Drawer": { "DepthStd": 500, "SlideAllowance": 26 }
  },
  "Order": [
    { "type": "drawer_3", "width": 600 },
    { "type": "base_1door", "width": 400 },
    { "type": "sink_1door", "width": 600 },
    { "type": "dishwasher_60", "width": 600 },
    { "type": "wall_1door", "width": 600 }
  ]
}</textarea>
      </div>
    </section>

    <!-- TAB 2: Rezime (BOM + Budžet) -->
    <section id="tab-summary" class="tabpanel stack" role="tabpanel" aria-hidden="true" aria-labelledby="tabbtn-summary">
      <div class="card">
        <h2>BOM (krojne liste frontova + korpusa) – agregat</h2>
        <div id="bom" class="mono" style="white-space:pre; background:#0a1220; border-radius:8px; padding:8px; min-height:180px"></div>
      </div>

      <div class="card">
        <h2>Budžetski obračun</h2>
        <div class="small" style="display:flex; flex-wrap:wrap; gap:12px; align-items:center; margin-bottom:8px">
          <label>Cena korpus materijala (RSD/m²): <input id="pCarcassM2" type="number" style="width:110px" placeholder="npr. 1200"></label>
          <label>Cena front materijala (RSD/m²): <input id="pFrontM2" type="number" style="width:110px" placeholder="npr. 2500"></label>
          <label>Cena šarke (RSD/kom): <input id="pHinge" type="number" style="width:100px" placeholder="npr. 250"></label>
          <label>Cena šine (RSD/par): <input id="pRail" type="number" style="width:100px" placeholder="npr. 1200"></label>
          <label>Cena ručice (RSD/kom): <input id="pHandle" type="number" style="width:100px" placeholder="npr. 600"></label>
          <label>Cena šrafa (RSD/kom): <input id="pScrew" type="number" style="width:100px" placeholder="npr. 5"></label>
          <label>Cena ABS trake (RSD/m): <input id="pAbsLm" type="number" style="width:110px" placeholder="npr. 60"></label>
          <label>Cena radne ploče (RSD/m): <input id="pTopLm" type="number" style="width:120px" placeholder="npr. 3200"></label>
          <label>Cena nogice (RSD/kom): <input id="pLeg" type="number" style="width:110px" placeholder="npr. 150"></label>
        </div>
        <div id="budget"></div>
      </div>
    </section>
  </div>

  <!-- Skripte -->
  <!-- Tab manager premesten u eksterni fajl zbog CSP (script-src 'self' bez 'unsafe-inline') -->
  <script src="app.tabs.js?v=1"></script>

  <script src="assets/three.min.js"></script>
  <script src="app.core.js?v=1"></script>
  <script src="app.bom.js?v=1"></script>
  <script src="app.budget.js"></script>
  <script src="app.ui.catalog.ext.js"></script>
  <script src="app.ui.catalog.icons.js"></script>
  <script src="app.models.js"></script>
  <script src="app.models.hook.js"></script>
  <script src="viewer3d.nomodule.v6.js"></script>
  <script src="app.ui.js"></script>
  <script src="app.fronts.tab.js"></script>
</body>
</html>
