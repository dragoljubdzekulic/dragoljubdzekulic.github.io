<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="utf-8">
  <title>3xMeri – Frontend kalkulator elemenata (modular)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self' data:;
    img-src 'self' data:;
    style-src 'self' 'unsafe-inline';
    script-src 'self';
    connect-src 'self';
    object-src 'none';
    base-uri 'self';
  ">
  <style>
    :root{ --bg:#0b0e14; --card:#111623; --ink:#e6ecf3; --ink-2:#bac7d9; --muted:#8d9bb1; --accent:#6ea8ff; --line:#222833; }
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.55 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
    h1{font-size:20px;margin:14px 0 12px}
    h2{font-size:16px;margin:0 0 8px}
    .wrap{max-width:1100px;margin:0 auto;padding:14px}
    .grid{display:flex;flex-direction:column;gap:12px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:10px;padding:12px}
    .small{color:var(--muted);font-size:13px}
    .flex{display:flex;gap:8px;align-items:center}
    input,textarea,button,select{background:#0d1322;color:var(--ink);border:1px solid var(--line);border-radius:8px;padding:8px}
    textarea{width:100%;min-height:240px;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-size:12px}
    button{cursor:pointer}
    table{border-collapse:collapse;width:100%}
    th,td{border-bottom:1px dashed #2a3140;padding:6px 8px;font-size:13px}
    th{color:#b8c7dd;text-align:left;font-weight:600}
    .ta-right{text-align:right}
    .toolbar button{padding:6px 10px;font-weight:600}
    .toolbar .spacer{flex:1}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>3xMeri – Frontend kalkulator elemenata</h1>
    <div class="card sticky" id="topToolbar" style="position:sticky; top:8px; z-index:10; display:flex; gap:8px; align-items:center;">
      <button id="btnRun">Recompute</button>
      <button id="btnReset">Reset JSON</button>
      <span class="spacer" style="flex:1"></span>
      <button id="btnIso">Iso</button>
      <button id="btnTop">Top</button>
      <button id="btnFront">Front</button>
      <button id="btnExplode">Explode</button>
      <button id="btnShot">Screenshot</button>
    </div>

    <div class="grid">
      <!-- 0) Izbor elemenata (builder) -->
      <div class="card">
        <h2>0) Izbor elemenata (gradi Order)</h2>
        <div id="catalog" class="flex" style="flex-wrap:wrap; gap:8px; margin-bottom:8px">
          <button data-type="drawer_3">+ Drawer 3</button>
          <button data-type="drawer_2">+ Drawer 2</button>
          <button data-type="combo_drawer_door">+ Combo (fioka+vrata)</button>
          <button data-type="base_1door">+ Base 1D</button>
          <button data-type="sink_1door">+ Sink 1D</button>
          <button data-type="dishwasher_60">+ Dishwasher 60</button>
          <button data-type="oven_housing">+ Oven housing</button>
          <button data-type="wall_1door">+ Viseći 1D</button>
          <button data-type="wall_open">+ Viseći otvoren</button>
          <button data-type="wall_open_shelf">+ Viseći otvoren + police</button>
        </div>
        <div id="builderList" class="small" style="margin-top:8px"></div>
        <div id="lenInfo" class="small" style="margin-top:6px"></div>
        <div class="small globals-row" style="margin-top:10px; display:flex; gap:10px; align-items:center; flex-wrap:wrap">
          <label>Visina korpusa H_carcass (mm): <input id="inpHCarcass" type="number" style="width:110px"></label>
          <label>Dubina korpusa (mm): <input id="inpDepth" type="number" style="width:100px"></label>
          <label>Debljina radne ploče (mm): <input id="inpTopThickness" type="number" style="width:120px" placeholder="npr. 38"></label>
          <label>Dubina fioka (standard):
            <select id="selDrawerDepth" style="width:130px">
              <option value="450">Plitke (450)</option>
              <option value="500" selected>Duboke (500)</option>
              <option value="550">Vrlo duboke (550)</option>
            </select>
          </label>
          <label>Toleranca šina (mm): <input id="inpSlideAllowance" type="number" style="width:120px" placeholder="npr. 26"></label>
          <label>Ukupna dužina kuhinje (mm): <input id="inpTotalLen" type="number" style="width:120px" placeholder="npr. 3000"></label>
          <label>H visećih (mm): <input id="inpHWall" type="number" style="width:90px" value="720"></label>
          <label>Donja ivica visećih (mm): <input id="inpWallBottom" type="number" style="width:110px" value="1450"></label>
          <label>Dubina visećih (mm): <input id="inpWallDepth" type="number" style="width:100px" value="320"></label>
        </div>
      </div>

      <!-- 3) 3D prikaz -->
      <div class="card">
        <h2>3) 3D prikaz</h2>
        <div id="viewer3d" style="width:100%; height:420px; background:#0c111b"></div>
        <div id="viewer3d-status" class="small" style="margin-top:6px"></div>
      </div>

      <!-- 2) Preview elemenata (2D) -->
      <div class="card">
        <h2>2) Proračun elemenata (preview)</h2>
        <div id="elements" class="flex" style="gap:10px; flex-wrap:wrap"></div>
      </div>

      <!-- 4) BOM i CSV -->
      <div class="card">
        <h2>4) BOM (krojne liste frontova + korpusa) – agregat</h2>
        <div class="flex" style="justify-content: space-between; gap:8px; margin-bottom:8px;">
          <div class="flex">
            <button id="btnCsv">Preuzmi CSV</button>
            <button id="btnCopyCsv">Copy CSV</button>
          </div>
          <a id="csvLink" class="small mono">CSV link</a>
        </div>
        <div id="bom"></div>
        <textarea id="csvRaw" class="mono" style="margin-top:10px" placeholder=",,CSV preview"></textarea>
      </div>

      <!-- 8) Budžetski obračun -->
      <div class="card">
        <h2>8) Budžetski obračun</h2>
        <div class="small" style="display:flex; flex-wrap:wrap; gap:12px; align-items:center; margin-bottom:8px">
          <label>Cena korpus materijala (RSD/m²): <input id="pCarcassM2" type="number" style="width:110px" placeholder="npr. 1200"></label>
          <label>Cena front materijala (RSD/m²): <input id="pFrontM2" type="number" style="width:110px" placeholder="npr. 2500"></label>
          <label>Cena šarke (RSD/kom): <input id="pHinge" type="number" style="width:100px" placeholder="npr. 250"></label>
          <label>Cena šine (RSD/par): <input id="pRail" type="number" style="width:100px" placeholder="npr. 1200"></label>
          <label>Cena ručice (RSD/kom): <input id="pHandle" type="number" style="width:100px" placeholder="npr. 600"></label>
          <label>Cena šrafa (RSD/kom): <input id="pScrew" type="number" style="width:100px" placeholder="npr. 5"></label>
          <label>Cena ABS trake (RSD/m): <input id="pAbsLm" type="number" style="width:110px" placeholder="npr. 60"></label>
          <label>Cena radne ploče (RSD/m): <input id="pTopLm" type="number" style="width:120px" placeholder="npr. 3200"></label>
          <label>Cena nogice (RSD/kom): <input id="pLeg" type="number" style="width:110px" placeholder="npr. 150"></label>
        </div>
        <div id="budget"></div>
      </div>

      <!-- 6) Globalne vrednosti i 7) Validacija -->
      <div class="card"><h2>6) Globalne vrednosti</h2><div id="globals" class="small"></div></div>
      <div class="card"><h2>7) Validacija</h2><div id="valid" class="small"></div><div id="msg" class="small" style="color:#f59b9b"></div></div>

      <!-- 1) Ulaz (JSON) -->
      <div class="card">
        <h2>1) Ulaz (JSON)</h2>
        <textarea id="jsonInput">{
  "Kitchen": {
    "H_total": 900,
    "H_plinth": 110,
    "T_top": 38,
    "Gap": 2,
    "Defaults": { "CarcassDepth": 560, "SideThickness": 18 },
    "Wall": { "H_carcass": 720, "Bottom": 1450, "Defaults": { "CarcassDepth": 320 } },
    "Drawer": { "DepthStd": 500, "SlideAllowance": 26 }
  },
  "Order": [
    { "id":"E1", "type":"drawer_3", "width":600, "depth":560, "drawerHeights":[170,200] },
    { "id":"E2", "type":"oven_housing", "width":600, "depth":560, "appliance":{ "ovenNiche":595 } },
    { "id":"E3", "type":"sink_1door", "width":600, "depth":560 }
  ]
}</textarea>
      </div>
    </div>
  </div>

  <!-- ⬇︎ NOVI poredak skripti (modularno) -->
  <script src="assets/three.min.js?v=r159"></script>
  <script src="app.core.js?v=1"></script>
  <script src="app.bom.js?v=1"></script>
  <script src="app.budget.js?v=1"></script>
  <script src="app.ui.js?v=1"></script>
  <script src="viewer3d.nomodule.v6.js?v=14"></script>
</body>
</html>